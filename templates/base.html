<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>
      {% block title %}{{ layout.title }} - {{ layout.brand_name }}{% endblock
      %}
    </title>
    <meta name="color-scheme" content="dark" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script
      src="https://unpkg.com/htmx.org@1.9.12"
      integrity="sha384-ujb1lZYygJmzgSwoxRggbCHcjc0rB2XoQrxeTUQyRjrOnlCoYta87iKBWq3EsdM2"
      crossorigin="anonymous"
      defer
    ></script>
    <script
      src="https://unpkg.com/feather-icons@4.29.0/dist/feather.min.js"
      integrity="sha384-RyE9TSx1shZZA6GS7TToIk1J7zY1mU8evbLDXYgOz4zgduwPFEtnHd1bswt8PG/u"
      crossorigin="anonymous"
      defer
    ></script>
    {% if let Some(csrf) = layout.csrf %}
    <meta name="csrf-token" content="{{ csrf.token }}" />
    {% endif %} {% block head %}{% endblock %}
  </head>
  <body class="h-full bg-gray-950 font-sans text-gray-200 antialiased">
    {% set nav_link = "inline-flex items-center gap-2 rounded-lg px-3 py-2
    text-sm font-medium text-gray-300 transition hover:bg-gray-900/60
    hover:text-white focus-visible:outline focus-visible:outline-2
    focus-visible:outline-offset-2 focus-visible:outline-sky-500/40" %} {% set
    nav_button = "inline-flex items-center justify-center gap-2 rounded-lg
    border border-gray-800 bg-gray-900/60 px-3 py-2 text-sm font-semibold
    text-gray-100 transition hover:border-sky-500/60 hover:text-white
    focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2
    focus-visible:outline-sky-400" %} {% set nav_primary = "inline-flex
    items-center justify-center gap-2 rounded-lg bg-sky-500 px-3 py-2 text-sm
    font-semibold text-gray-950 shadow-sm transition hover:bg-sky-400
    focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2
    focus-visible:outline-sky-200" %} {% set user_badge = "inline-flex
    items-center gap-2 rounded-full border border-gray-800 bg-gray-900/80 px-3
    py-1 text-xs font-semibold uppercase tracking-wide text-gray-300" %}

    <div class="flex min-h-screen flex-col">
      <header
        class="sticky top-0 z-30 border-b border-gray-800 bg-gray-950/90 backdrop-blur"
      >
        <nav
          class="mx-auto flex w-full max-w-6xl flex-col gap-4 px-6 py-5 md:flex-row md:items-center md:justify-between"
        >
          <div
            class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between sm:gap-6"
          >
            <a
              href="/"
              class="flex items-center gap-2 text-xl font-semibold text-white transition hover:text-sky-300"
            >
              {{ layout.brand_name }}
            </a>
            <div class="flex flex-wrap items-center gap-2 md:gap-3">
              <a href="/" class="{{ nav_link }}">Home</a>
              {% if let Some(user) = layout.current_user %}
              <a href="/upload" class="{{ nav_link }}">Upload</a>
              <a href="/paste" class="{{ nav_link }}">Pastebin</a>
              {% if user.is_admin %}
              <a href="/settings" class="{{ nav_link }}">Settings</a>
              <a href="/admin/users" class="{{ nav_link }}">Users</a>
              {% endif %} {% endif %}
            </div>
          </div>
          <div class="flex flex-wrap items-center gap-3 md:justify-end">
            {% if let Some(user) = layout.current_user %}
            <span class="{{ user_badge }}">
              <i data-feather="user" class="h-4 w-4"></i>
              {{ user.username }}
            </span>
            <form method="post" action="/logout" class="inline-flex">
              {% if let Some(csrf) = layout.csrf %}
              <input type="hidden" name="csrf_token" value="{{ csrf.token }}" />
              {% endif %}
              <button type="submit" class="{{ nav_button }}">Log out</button>
            </form>
            {% else %} {% if layout.registration_open %}
            <a href="/register" class="{{ nav_primary }}">Register</a>
            {% endif %}
            <a href="/login" class="{{ nav_button }}">Login</a>
            {% endif %}
          </div>
        </nav>
      </header>

      <main class="flex-1">
        <div class="mx-auto w-full max-w-6xl px-6">
          {% block content %}{% endblock %}
        </div>
      </main>

      <footer class="border-t border-gray-800 bg-gray-950/90">
        <div
          class="mx-auto flex w-full max-w-6xl flex-col items-center gap-2 px-6 py-8 text-xs text-gray-500 sm:flex-row sm:justify-between"
        >
          <span
            >&copy; {{ layout.current_year }} {{ layout.brand_name }}. All
            rights reserved.</span
          >
          <span class="text-gray-600">Secure sharing for teams.</span>
        </div>
      </footer>
    </div>

    <script>
      "use strict";

      const activateFeatherIcons = () => {
        if (window.feather) {
          window.feather.replace({ "aria-hidden": "true" });
        }
      };

      document.addEventListener("DOMContentLoaded", activateFeatherIcons);
      document.body.addEventListener("htmx:afterSwap", activateFeatherIcons);

      document.body.addEventListener("htmx:configRequest", (event) => {
        const tokenElement = document.querySelector('meta[name="csrf-token"]');
        if (!tokenElement) {
          return;
        }

        const token = tokenElement.getAttribute("content");
        if (!token) {
          return;
        }

        event.detail.headers["X-CSRF-Token"] = token;
      });

      document.addEventListener("click", (event) => {
        const trigger = event.target.closest("[data-copy]");
        if (!trigger) {
          return;
        }

        const explicitValue = trigger.getAttribute("data-copy-text");
        const targetSelector = trigger.getAttribute("data-copy-target");
        let copyValue = explicitValue;

        if (!copyValue && targetSelector) {
          const target = document.querySelector(targetSelector);
          if (target) {
            if (
              target instanceof HTMLInputElement ||
              target instanceof HTMLTextAreaElement
            ) {
              copyValue = target.value;
            } else {
              copyValue = target.textContent;
            }
          }
        }

        if (!copyValue) {
          return;
        }

        navigator.clipboard
          .writeText(copyValue.trim())
          .then(() => {
            trigger.dataset.copyState = "copied";
            setTimeout(() => {
              if (trigger.dataset.copyState === "copied") {
                delete trigger.dataset.copyState;
              }
            }, 2000);
          })
          .catch((error) => {
            console.error("Failed to copy to clipboard", error);
          });
      });
    </script>
    {% block body_scripts %}{% endblock %}
  </body>
</html>
